<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/comment.css">
    <script>
        $(function () {
            var params = getParams();
            // if (params.id) {
            //     //根据a标签id获取
            //     $.get("/replies/" + params.id, function (data) {
            //         $(".title").html(data.title)
            //         //共享编辑器
            //         // $(".travels").renderValues(data)
            //     });
            // }


            //----------------------------------------


            var currentPage = 1;
            var pages;

            var replyArr = [];

            function query() {
                // type = 1 是游记的评论
                $.get("/replies", {currentPage: currentPage, targetId: params.id, type: 1}, function (data) {
                    $.merge(replyArr, data.list);

                    // 渲染数据
                    $(".comment_list").renderValues({list: replyArr});
                    // $(".comment_list").renderValues({list: replyArr}, {
                    //     getHref: function (item, value) {
                    //         console.log(item); // a连接
                    //         console.log(value); // id值
                    //
                    //         $(item).attr('href', '/mine/editTravels.html?id=' + value);
                    //     }
                    // });
                    // 获取总页数
                    pages = data.pages;
                })
                currentPage++;
            }

            // 默认查询第一页
            query();

            // 给window绑定滚动事件
            $(window).scroll(function () {
                if ($(window).height() + $(document).scrollTop() + 1 >= $(document).height()) {
                    console.log(currentPage);
                    // 如果是大于总页数就不发送请求了
                    if (currentPage <= pages) {
                        query();
                    } else {
                        $(document).dialog({
                            type: 'notice',
                            content: '<span class="info-text">亲，已经到底了！</span>',
                            autoClose: 2500
                        });
                    }
                }
            })
        })

    </script>
</head>
<body>

<div class="body_b">
    <div id="pos38"></div>
    <div class="wrapper">
        <header class="head2home">
            <a href="/" class="logo"></a>
            <div class="rBtn">
                <a href="/" class="home">官网首页</a>
            </div>
        </header>
    </div>
        <section class="container">

            <input id="_j_uid" type="hidden" value="">
            <input id="_j_redirecturl" type="hidden" value="">
            <article class="comment">
                <section class="comment_detail">
                    <h1>回复游记：十六天，带娃穿越四季，2018年国庆北美自驾行（西雅图、温哥华、班夫）</h1>
                    <ul class="comment_lsit" id="_j_commentlist">
                        <li>
                            <a href="" class="cl_ava" title="dg777/上海">
                                <img src="https://b2-q.mafengwo.net/s12/M00/EC/7B/wKgED1uJ462AWXXVACo362rk_W405.jpeg?imageMogr2%2Fthumbnail%2F%2148x48r%2Fgravity%2FCenter%2Fcrop%2F%2148x48%2Fquality%2F90"
                                     alt="dg777/上海">
                            </a>
                            <a href="" class="cl_name" title="dg777/上海">dg777/上海</a>
                            <a href="" class="cl_rating" title="LV.21">LV.21</a>
                            <a role="button" class="cl_reply _j_reply" data-id="11361122" data-rid="74316050" title="回复"
                               data-uname="dg777/上海">回复</a>
                            <div class="cl_time">昨天23:05</div>

                            <div class="cl_con">
                                <div class="cl_quote cl_quote_img">
                                    <span>引用 Veronica 的图片：</span>
                                    <img src="https://p4-q.mafengwo.net/s12/M00/41/45/wKgED1wOZO2AVzd1AAoPT8srwPU69.jpeg?imageView2%2F2%2Fw%2F600%2Fq%2F90"
                                         class="replace-file-img">
                                </div>
                                <img src="https://images.mafengwo.net/images/i/face/daily_v2/28.png">
                            </div>
                        </li>

                    </ul>

                </section>
            </article>

        </section>

            <section class="reply_box bgef" id="_js_replyBox">
                <div class="reply_title">
                    <div class="re-hd">我要回复</div>
                    <div class="btn">
                        <a class="close _j_close"><i></i></a>
                        <a class="submit _j_submit"><i></i></a>
                    </div>
                </div>
                <div class="reply-wrap"><textarea title="" id="_j_replyarea"></textarea></div>
            </section>

            <footer class="footer footer_comment foot-bar-reply">
                <div class="comment_replay"><input id="_j_replyinput" type="text" placeholder="回复"></div>
            </footer>
    </div>
</body>
</html>
